name: Playwright BDD Tests

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    # ğŸ“¥ Checkout the repository
    - name: ğŸ“¥ Checkout repo
      uses: actions/checkout@v3

    # ğŸ³ Set up Docker Buildx for building container images
    - name: ğŸ³ Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    # ğŸ› ï¸ Build Docker image for Playwright BDD tests
    - name: ğŸ› ï¸ Build Docker image
      run: docker build -t playwright-bdd-tests .

    # ğŸ§¹ Clean up allure-results folder on host to avoid stale files
    - name: ğŸ§¹ Clean allure-results folder
      run: |
        rm -rf allure-results
        mkdir -p allure-results

    # ğŸ§ª Run BDD Tests in Docker
    - name: ğŸ§ª Run BDD Tests in Docker
      run: |
        docker run --rm \
          -v ${{ github.workspace }}/allure-results:/app/allure-results \
          playwright-bdd-tests

    # ğŸ“¤ Upload Allure results as a CI/CD artifact
    - name: ğŸ“¤ Upload Allure Results (artifact)
      uses: actions/upload-artifact@v4
      with:
        name: allure-results
        path: allure-results

    # ğŸ“Š (Optional) Generate and Upload Allure HTML Report
    - name: ğŸ“Š Generate Allure Report
      uses: simple-elf/allure-report-action@v1
      with:
        results-directory: allure-results
        report-directory: allure-report

    - name: ğŸ“¤ Upload Allure Report (HTML)
      uses: actions/upload-artifact@v4
      with:
        name: allure-report
        path: allure-report
